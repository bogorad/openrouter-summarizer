{"id":"ORS-0rc","title":"Memory leak from uncleaned event listeners in highlighter.js","description":"The highlighter.js module attaches event listeners to window and document in initializeHighlighter() but does not provide a cleanup function to remove them when the content script is unloaded or reloaded. Old event listeners hold references to DOM elements and prevent garbage collection.\n\n**Location:** highlighter.js:254-265 (initializeHighlighter)\n\n**Fix:** Implement addTrackedEventListener() helper that stores listeners in an array. Export cleanupHighlighter() function that removes all tracked listeners. Call cleanup on window unload event.","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:25.776969565+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:44:50.275431599+01:00","closed_at":"2026-01-31T14:44:50.275431599+01:00","close_reason":"Fixed memory leak by implementing tracked event listeners and cleanupHighlighter() function","labels":["bug","medium","memory"]}
{"id":"ORS-14x","title":"[HIGH] Missing Content Security Policy in manifest.json","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:13.882729222+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:49.958259369+01:00","closed_at":"2026-01-31T15:13:49.958259369+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-2bv","title":"[LOW] Missing ARIA attributes on dynamic UI elements","description":"## Problem\nDynamically created elements in joplinManager.js and floatingIcon.js lack proper ARIA attributes, reducing accessibility for screen reader users.\n\n## Evidence\nPer CONVENTIONS.md requirement:\n'Implement accessibility features on elements. For example, a tag should have a tabindex=\"0\", aria-label, on:click, and on:keydown'\n\njoplinManager.js popup lacks:\n- role=\"dialog\"\n- aria-modal=\"true\"\n- aria-labelledby\n\nfloatingIcon.js may lack:\n- aria-label on icon button\n- keyboard event handlers\n\n## Impact\n- Screen reader users cannot navigate extension UI\n- Violates CONVENTIONS.md requirements\n- Reduces usability for users with disabilities\n\n## Fix Required\n1. Add role='dialog', aria-modal='true', aria-labelledby to Joplin popup\n2. Add aria-label to floating icon button\n3. Ensure all interactive elements have tabindex and keyboard handlers\n4. Test with screen reader","status":"open","priority":4,"issue_type":"task","owner":"bogorad@gmail","created_at":"2026-01-31T15:16:23.93902352+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:16:23.93902352+01:00"}
{"id":"ORS-39g","title":"Broad \u003call_urls\u003e host permission violates least privilege","description":"The manifest.json declares \u003call_urls\u003e in both host_permissions and content_scripts.matches, granting the extension access to read and modify content on every website. This is excessive for an extension that only needs access when the user explicitly activates it via Alt+Click. Combined with the XSS vulnerability, this creates a critical attack chain.\n\n**Location:** manifest.json:12-14 (host_permissions), manifest.json:21-23 (content_scripts.matches)\n\n**Fix:** Remove broad host_permissions and rely on activeTab permission with optional_host_permissions for user-granted access.","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:21:57.889438403+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:35:57.271448795+01:00","closed_at":"2026-01-31T14:35:57.271448795+01:00","close_reason":"Fixed - removed \u003call_urls\u003e from host_permissions, added optional_host_permissions, bumped version to 3.9.5","labels":["high","security"]}
{"id":"ORS-46z","title":"Remove unused numToWord object (dead code)","description":"The pageInteraction.js file defines a numToWord object at lines 37-44 that is never used anywhere in the codebase. This is dead code that should be removed.\n\n**Location:** pageInteraction.js:37-44\n\n**Fix:** Delete the unused numToWord const declaration.","status":"closed","priority":3,"issue_type":"chore","owner":"bogorad@gmail","created_at":"2026-01-31T14:23:27.997197748+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:54:30.162601455+01:00","closed_at":"2026-01-31T14:54:30.162601455+01:00","close_reason":"Fixed","labels":["code-quality","dead-code","low"]}
{"id":"ORS-4ju","title":"Insecure Storage of API Tokens in chrome.storage.sync","description":"The extension stores OpenRouter API keys, NewsBlur tokens, and Joplin tokens in chrome.storage.sync without encryption. Chrome's sync storage synchronizes data across all devices signed into the same Google account via Google's servers. The keys are accessible to Google and vulnerable to: (1) Google account compromise, (2) Browser forensic analysis, (3) Malicious extensions with storage permissions.\n\n**Location:** options.js:1363-1450 (saveSettings), background.js:74-76 (API key retrieval)\n\n**Fix:** Use chrome.storage.local instead of sync for sensitive tokens. Implement AES-GCM encryption using Web Crypto API before storage.","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:21:49.016386881+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:34:36.831264712+01:00","closed_at":"2026-01-31T14:34:36.831264712+01:00","close_reason":"Fixed: Implemented AES-GCM encryption for API tokens using Web Crypto API. Tokens are now stored in chrome.storage.local instead of chrome.storage.sync, preventing synchronization to Google servers. Added migration logic to move existing tokens from sync to encrypted local storage.","labels":["high","security"]}
{"id":"ORS-4md","title":"[LOW] Replace magic numbers with named constants","status":"closed","priority":3,"issue_type":"task","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:18.603739163+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:50.055500451+01:00","closed_at":"2026-01-31T15:13:50.055500451+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-50s","title":"Missing language detection response validation","description":"The detectLanguage() function in summaryHandler.js accepts the LLM's response as a 3-character ISO 639-2 code with minimal validation. Only checks length === 3, not character set (could contain special characters, numbers). No whitelist of valid language codes. Malformed response could cause injection or malformed prompts.\n\n**Location:** js/summaryHandler.js:64-79 (language code validation)\n\n**Fix:** Add regex validation /^[a-z]{3}$/ and whitelist of valid ISO 639-2 codes in constants.js (VALID_LANGUAGE_CODES Set).","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:40.157982252+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:47:21.275620325+01:00","closed_at":"2026-01-31T14:47:21.275620325+01:00","close_reason":"Fixed: Added language code validation with ISO 639-2 whitelist to prevent injection from malformed LLM responses","labels":["bug","medium","validation"]}
{"id":"ORS-5vw","title":"[MEDIUM] Insufficient URL validation in Joplin API calls","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:16.991789534+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:50.022105948+01:00","closed_at":"2026-01-31T15:13:50.022105948+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-75m","title":"Remove LLM-addressed comment artifact in constants.js","description":"The constants.js file contains a comment block at lines 3-9 addressed to 'LLMs' that appears to be a prompt engineering artifact rather than documentation. This is confusing to human developers.\n\n**Location:** constants.js:3-9\n\n**Fix:** Remove the inappropriate comment and replace with standard JSDoc documentation for the constants file.","status":"closed","priority":3,"issue_type":"chore","owner":"bogorad@gmail","created_at":"2026-01-31T14:23:08.191976302+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:51:51.142294842+01:00","closed_at":"2026-01-31T14:51:51.142294842+01:00","close_reason":"Fixed: Removed LLM-addressed comment artifact and replaced with standard JSDoc documentation in constants.js","labels":["code-quality","low"]}
{"id":"ORS-878","title":"Inconsistent message handler return patterns cause channel closure","description":"The handleMessage() function in pageInteraction.js has inconsistent return patterns. Some paths return true (async response), others return false or nothing. When chrome.runtime.onMessage.addListener returns false/undefined, Chrome immediately closes the message port. Later sendResponse() calls fail with 'disconnected port object' error.\n\n**Location:** pageInteraction.js:765-809\n\n**Fix:** Always return true from message handlers. Wrap all handling in async IIFE and always call sendResponse() in all code paths.","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:32.72143595+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:45:59.938225517+01:00","closed_at":"2026-01-31T14:45:59.938225517+01:00","close_reason":"Fixed: handleMessage now always returns true, uses async IIFE, and always calls sendResponse() in all code paths","labels":["bug","medium"]}
{"id":"ORS-8n5","title":"[HIGH] Insecure token migration - no verification before clearing sync storage","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:14.820618363+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:49.97462685+01:00","closed_at":"2026-01-31T15:13:49.97462685+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-95m","title":"[LOW] Remove unused handleLastError import from background.js","description":"## Problem\nThe audit claims background.js imports handleLastError from errorHandler.js but never uses it. This is dead code that should be removed.\n\n## Evidence\nAudit claims location: background.js lines 27-30\n\n## Action Required\n1. Verify the import exists and is unused\n2. Remove the unused import\n3. Check for other unused imports in the file","status":"open","priority":3,"issue_type":"task","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:41.530060929+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:14:41.530060929+01:00"}
{"id":"ORS-9xa","title":"[LOW] Inconsistent error logging levels across codebase","description":"## Problem\nThe codebase uses console.error, console.warn, and console.log inconsistently. Some error conditions are logged as warnings or info, while some non-errors are logged as errors.\n\n## Evidence\nMultiple files use different patterns:\n- Some errors logged with console.log\n- Some info messages logged with console.error\n- No consistent prefix convention\n\n## Impact\n- Debugging difficult - hard to filter real errors\n- Console noise masks real issues\n- No way to programmatically distinguish log levels\n\n## Fix Required\nConsider implementing a Logger utility:\nconst Logger = {\n  debug: (msg, ...args) =\u003e DEBUG \u0026\u0026 console.log('[Debug]', msg, ...args),\n  info: (msg, ...args) =\u003e console.log('[Info]', msg, ...args),\n  warn: (msg, ...args) =\u003e console.warn('[Warn]', msg, ...args),\n  error: (msg, ...args) =\u003e console.error('[Error]', msg, ...args)\n};\n\nApply consistently across all files.","status":"open","priority":4,"issue_type":"task","owner":"bogorad@gmail","created_at":"2026-01-31T15:16:18.905992319+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:16:18.905992319+01:00"}
{"id":"ORS-9yy","title":"[CRITICAL] XSS vulnerability in HTML rendering pipeline - javascript: URLs allowed","status":"closed","priority":0,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:13.127505631+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:49.942750571+01:00","closed_at":"2026-01-31T15:13:49.942750571+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-a2x","title":"[HIGH] Missing Content Security Policy in manifest.json","description":"## Problem\nThe manifest.json lacks an explicit content_security_policy definition. While MV3 provides default CSP for extension pages, the extension processes untrusted LLM responses and web content, requiring stricter controls.\n\n## Evidence\nmanifest.json has no content_security_policy key (verified lines 1-67).\n\n## Impact\nWithout explicit CSP:\n- Inline scripts could execute if injected\n- eval-based attacks possible\n- No restriction on connect-src for API calls\n\n## Fix Required\nAdd to manifest.json:\ncontent_security_policy: {\n  extension_pages: \"script-src 'self'; object-src 'self'; connect-src https://openrouter.ai https://*.newsblur.com http://localhost:*;\"\n}","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:16.156514664+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:22:54.269772541+01:00","closed_at":"2026-01-31T15:22:54.269772541+01:00","close_reason":"Added content_security_policy to manifest.json"}
{"id":"ORS-a85","title":"Inconsistent error handling patterns cause silent failures","description":"The codebase exhibits inconsistent error handling patterns. Some functions use try-catch, others use callback error parameters, many use a mix. Errors are sometimes logged to console, sometimes shown via showError(), sometimes silently swallowed. The chrome.runtime.lastError pattern is inconsistently applied.\n\n**Location:** pageInteraction.js:247-270, background.js:321-339, js/summaryHandler.js:145-161\n\n**Fix:** Create a centralized ErrorHandler class with handle(), getUserFriendlyMessage(), and trackError() methods. Standardize across all modules.","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:18.68089058+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:43:22.333580739+01:00","closed_at":"2026-01-31T14:43:22.333580739+01:00","close_reason":"Fixed: Created centralized ErrorHandler class with handle(), getUserFriendlyMessage(), and trackError() methods. Standardized error handling across pageInteraction.js, background.js, and js/summaryHandler.js. Added handleLastError() helper for chrome.runtime.lastError pattern.","labels":["medium","refactor"]}
{"id":"ORS-cs7","title":"[MEDIUM] Decryption failures indistinguishable from missing data","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:15.637209847+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:49.990946833+01:00","closed_at":"2026-01-31T15:13:49.990946833+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-dw7","title":"Race condition in AbortController storage for chat requests","description":"The chat abort mechanism stores the AbortController instance in chrome.storage.session. Chrome's storage API uses JSON serialization which strips object methods. The AbortController loses its abort() method when retrieved. The check 'typeof controller.abort === function' fails because the storage retrieval returns a plain object.\n\n**Location:** js/chatHandler.js:62-64 (AbortController storage), js/chatHandler.js:134-182 (abort handling)\n\n**Fix:** Use an in-memory Map for controller storage instead of session storage. Store only the requestId in session storage for abort lookup.","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:12.395119282+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:40:30.544547371+01:00","closed_at":"2026-01-31T14:40:30.544547371+01:00","close_reason":"Fixed: Replaced chrome.storage.session with in-memory Map for AbortController storage to prevent race condition where JSON serialization strips abort() method","labels":["bug","high"]}
{"id":"ORS-evu","title":"[LOW] Replace magic numbers with named constants","description":"## Problem\nVarious magic numbers are scattered throughout the codebase without named constants, reducing maintainability and readability.\n\n## Evidence\n- 60000 in js/chatHandler.js (controller timeout)\n- 3000 in notification calls (per ADR this is intentional but should be constant)\n- 65568 snippet truncation limit\n- 50 max error log entries\n\n## Action Required\nAdd to constants.js:\nexport const CONTROLLER_TIMEOUT_MS = 60000;\nexport const NOTIFICATION_TIMEOUT_MS = 3000;\nexport const SNIPPET_TRUNCATION_LIMIT = 65568;\nexport const MAX_ERROR_LOG_ENTRIES = 50;\nexport const MAX_CONTROLLERS = 100;\n\nUpdate all files to import and use these constants.","status":"open","priority":3,"issue_type":"task","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:45.8956939+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:14:45.8956939+01:00"}
{"id":"ORS-f52","title":"XSS in Chat Message Rendering via unsanitized innerHTML","description":"The chat.js file renders assistant messages by directly assigning HTML content to innerHTML without sanitization. The renderTextAsHtml() function in utils.js uses marked.parse() but the sanitize option is deprecated and does NOT prevent XSS from LLM responses. An attacker who compromises the OpenRouter API or poisons the LLM response could inject arbitrary JavaScript that executes in the extension's chat page context, granting access to chrome.storage (containing API keys).\n\n**Location:** chat.js:504-563 (renderMessages), utils.js:121-124 (renderTextAsHtml)\n\n**Fix:** Implement DOMPurify sanitization before DOM insertion and add CSP headers to chat.html.","status":"closed","priority":0,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:21:39.395237164+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:27:47.642002658+01:00","closed_at":"2026-01-31T14:27:47.642002658+01:00","close_reason":"Fixed: Implemented DOMPurify sanitization to replace deprecated marked.parse() sanitize option, preventing XSS attacks from malicious LLM responses","labels":["critical","security"]}
{"id":"ORS-jkc","title":"XPath partial class matching in HTML sanitizer removes legitimate content","description":"The htmlSanitizer.js module uses XPath contains(@class, 'ad') which matches partial class names (e.g., 'ad' matches 'ad-banner', 'load-ad', 'loading', etc.). This overly aggressive matching removes legitimate content.\n\n**Location:** js/htmlSanitizer.js:132-148\n\n**Fix:** Replace XPath with CSS selectors using word-boundary matching [class~='classname']. This ensures exact word match, not partial string match.","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:46.626391634+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:48:13.654508866+01:00","closed_at":"2026-01-31T14:48:13.654508866+01:00","close_reason":"Fixed","labels":["bug","medium"]}
{"id":"ORS-om3","title":"[CRITICAL] XSS vulnerability in HTML rendering pipeline","description":"## Problem\nThe renderTextAsHtml function in utils.js (lines 167-169) allows \u003ca\u003e tags with href attributes through DOMPurify sanitization. This permits javascript: URLs to pass through, enabling XSS attacks via prompt injection in LLM responses.\n\nAdditionally, summaryPopup.js (lines 414-415) sets innerHTML directly without sanitization when content starts with \u003cul\u003e.\n\n## Evidence\nutils.js:167-169:\nALLOWED_TAGS includes 'a'\nALLOWED_ATTR includes 'href'\n\nsummaryPopup.js:414-415:\nif (content.startsWith('\u003cul\u003e')) { contentDiv.innerHTML = content; }\n\n## Impact\nAttacker can inject malicious JavaScript through LLM response manipulation, potentially stealing API keys or session data.\n\n## Fix Required\n1. Remove 'a' from ALLOWED_TAGS or add FORBID_ATTR: ['href'] with javascript: protocol\n2. Add DOMPurify.sanitize() call in summaryPopup.js before innerHTML assignment\n3. Consider using textContent where HTML rendering is not required","status":"closed","priority":0,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:11.023183154+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:19:50.881976973+01:00","closed_at":"2026-01-31T15:19:50.881976973+01:00","close_reason":"Fixed in commit 369c18e"}
{"id":"ORS-pa5","title":"[LOW] Error handler trackError silently ignores chrome.runtime.lastError","description":"## Problem\nThe trackError method in js/errorHandler.js (lines 78-89) uses chrome.storage.local.get/set callbacks but never checks chrome.runtime.lastError. If storage is full or corrupted, errors are silently lost.\n\n## Evidence\njs/errorHandler.js:80-84:\nchrome.storage.local.get(['errorLog'], (data) =\u003e {\n  const log = data.errorLog || [];\n  log.push(errorInfo);\n  if (log.length \u003e 50) log.shift();\n  chrome.storage.local.set({ errorLog: log });\n});\n\nNo chrome.runtime.lastError check in either callback.\n\n## Impact\n- Storage failures go unnoticed\n- Error logs may be silently lost\n- Debugging becomes harder when error tracking itself fails\n\n## Fix Required\n1. Check chrome.runtime.lastError after get() callback\n2. Check chrome.runtime.lastError after set() callback\n3. Use console.warn (not error) to log tracking failures\n4. Keep outer try/catch to prevent crashes","status":"open","priority":3,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:16:13.299414704+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:16:13.299414704+01:00"}
{"id":"ORS-ppc","title":"Hardcoded language detection model with no fallback","description":"The detectLanguage() function uses a hardcoded model ID 'moonshotai/kimi-k2' without fallback options. If this model becomes unavailable, deprecated, or the user doesn't have access to it, language detection fails silently and defaults to English.\n\n**Location:** js/summaryHandler.js:21\n\n**Fix:** Add LANGUAGE_DETECTION_MODELS array in constants.js with multiple models. Iterate through models with try-catch fallback on failure.","status":"closed","priority":3,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:23:22.714874928+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:53:56.014915171+01:00","closed_at":"2026-01-31T14:53:56.014915171+01:00","close_reason":"Fixed: Added LANGUAGE_DETECTION_MODELS array with 3 fallback models, updated detectLanguage() to iterate through models with try-catch, logs which model succeeded, and falls back to 'eng' if all fail","labels":["low","resilience"]}
{"id":"ORS-sk3","title":"[LOW] Remove unused handleLastError import from background.js","status":"closed","priority":3,"issue_type":"task","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:17.873009126+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:50.037540684+01:00","closed_at":"2026-01-31T15:13:50.037540684+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-stb","title":"Debug logging may leak sensitive data","description":"When DEBUG mode is enabled, the code logs various objects that may contain sensitive information. API key masking is inconsistent and doesn't cover all sensitive fields. Stack traces and error objects may contain tokens.\n\n**Location:** options.js:274-281, utils.js:46-96\n\n**Fix:** Create redactSensitiveData() function that recursively masks keys containing 'apiKey', 'token', 'password', 'secret', 'auth'. Use in all DEBUG logging.","status":"closed","priority":3,"issue_type":"chore","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:53.869972771+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:49:50.487078478+01:00","closed_at":"2026-01-31T14:49:50.487078478+01:00","close_reason":"Fixed: Added redactSensitiveData() function to utils.js and applied it to DEBUG logging in options.js to prevent leaking sensitive information like API keys and tokens","labels":["low","security"]}
{"id":"ORS-tiq","title":"No input validation on HTML content processing - DoS vector","description":"The processSelectedElement() function in pageInteraction.js processes user-selected HTML content without validating content size, nesting depth, or structure complexity. No limits on: (1) total content size (could be megabytes), (2) DOM nesting depth (could cause stack overflow), (3) number of elements. The Turndown library is called on potentially massive HTML, blocking the main thread.\n\n**Location:** pageInteraction.js:59-199 (processSelectedElement function)\n\n**Fix:** Add MAX_CONTENT_SIZE (1MB), MAX_NESTING_DEPTH (100), MAX_ELEMENT_COUNT (10000) constants and validate before processing.","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T14:22:05.112874645+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:37:48.916282874+01:00","closed_at":"2026-01-31T14:37:48.916282874+01:00","close_reason":"Fixed: Added input validation with MAX_CONTENT_SIZE (1MB), MAX_NESTING_DEPTH (100), and MAX_ELEMENT_COUNT (10000) limits to prevent DoS attacks","labels":["high","security"]}
{"id":"ORS-ukp","title":"[HIGH] Insecure token migration - no verification before clearing sync storage","description":"## Problem\nThe migrateTokensToEncryptedStorage function in background.js (lines 63-94) clears tokens from sync storage immediately after calling chrome.storage.local.set() without verifying:\n1. encryptSensitiveData returned valid encrypted data\n2. The data was actually persisted to local storage\n\n## Evidence\nbackground.js:72-90:\n- Calls encryptSensitiveData but doesn't check return value\n- Calls chrome.storage.local.set(migrations) without await verification\n- Immediately calls chrome.storage.sync.remove() \n\n## Impact\nIf encryption fails silently or storage.local.set fails, user loses their API tokens permanently with no recovery path.\n\n## Fix Required\n1. Validate encryptSensitiveData returns non-empty strings\n2. After storage.local.set, read back and verify data matches\n3. Only then call storage.sync.remove\n4. Add try/catch with rollback - keep sync tokens if migration fails\n5. Log migration success/failure for debugging","status":"closed","priority":1,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:22.968628571+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:25:14.818554924+01:00","closed_at":"2026-01-31T15:25:14.818554924+01:00","close_reason":"Fixed: added encryption validation, read-back verification, and try/catch rollback"}
{"id":"ORS-uzr","title":"Missing accessibility attributes on dynamic elements","description":"Several dynamically created elements in options.js and chat.js lack proper accessibility attributes. Autocomplete dropdown items, language flag buttons, and model selection elements should include aria-label, role, tabindex, and keyboard activation support per CONVENTIONS.md.\n\n**Location:** options.js:304-368 (autocomplete dropdown creation)\n\n**Fix:** Add role='listbox' to dropdown container, role='option' and tabindex='0' to items, aria-label attributes, and keydown handlers for Enter/Space activation.","status":"closed","priority":3,"issue_type":"chore","owner":"bogorad@gmail","created_at":"2026-01-31T14:23:15.450519683+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:52:54.363465056+01:00","closed_at":"2026-01-31T14:52:54.363465056+01:00","close_reason":"Fixed","labels":["accessibility","low"]}
{"id":"ORS-v7a","title":"[MEDIUM] Memory leak in activeControllers Map - no size limit","description":"## Problem\nThe activeControllers Map in js/chatHandler.js (line 10) stores AbortControllers with 60-second timeout cleanup, but has no maximum size limit. Rapid requests before timeouts fire can grow the map unbounded.\n\n## Evidence\njs/chatHandler.js:10:\nconst activeControllers = new Map();\n\njs/chatHandler.js:76-89:\n- Adds entry on each request\n- 60-second setTimeout for cleanup\n- No size check before adding\n\n## Impact\nIn pathological cases (many rapid requests, or if setTimeout callbacks fail), memory grows unbounded. Service worker could become slow or crash.\n\n## Fix Required\n1. Add MAX_CONTROLLERS constant (e.g., 100)\n2. Before adding new entry, check size\n3. If at limit, abort and remove oldest entries (20%)\n4. Add periodic cleanup interval as backup (every 30s)\n5. Wrap abort() in try/catch to prevent cleanup failures","status":"open","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:34.235107448+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:14:34.235107448+01:00"}
{"id":"ORS-wf9","title":"Use const instead of let for constants in background.js","description":"The background.js file uses 'let' for constants like DEFAULT_BULLET_COUNT and DEFAULT_DEBUG_MODE. These values should never be reassigned and should use 'const' per CONVENTIONS.md.\n\n**Location:** background.js:47-48\n\n**Fix:** Change 'let DEFAULT_BULLET_COUNT = \"5\"' to 'const DEFAULT_BULLET_COUNT = \"5\"' and similar for DEFAULT_DEBUG_MODE.","status":"closed","priority":3,"issue_type":"chore","owner":"bogorad@gmail","created_at":"2026-01-31T14:23:01.800446712+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T14:50:48.311518093+01:00","closed_at":"2026-01-31T14:50:48.311518093+01:00","close_reason":"Fixed - constants already using const, updated version and changelog","labels":["code-quality","low"]}
{"id":"ORS-xyf","title":"[MEDIUM] Decryption failures indistinguishable from missing data","description":"## Problem\nThe decryptSensitiveData function in js/encryption.js (lines 66-88) returns empty string for both 'no data provided' and 'decryption failed' scenarios. Callers cannot distinguish between a missing token and a corrupted/tampered token.\n\n## Evidence\njs/encryption.js:66-67:\nif (!encrypted) return '';\n\njs/encryption.js:84-86:\n} catch (e) {\n  console.error('[Encryption] Decryption failed:', e);\n  return '';\n}\n\n## Impact\n- Security issues masked (tampering not detected)\n- Data corruption not surfaced to user\n- Debugging difficult - same empty result for different failures\n\n## Fix Required\nReturn a result object instead of string:\n{ success: boolean, data: string, error: string|null }\n\nUpdate all callers (chatHandler.js, background.js) to check success before using data.","status":"open","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:28.215674214+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:14:28.215674214+01:00"}
{"id":"ORS-yro","title":"[MEDIUM] Memory leak potential in activeControllers Map - no size limit","status":"closed","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:13:16.464223352+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:13:50.006533153+01:00","closed_at":"2026-01-31T15:13:50.006533153+01:00","close_reason":"Recreating with comprehensive descriptions"}
{"id":"ORS-z3q","title":"[MEDIUM] Insufficient URL validation in Joplin API calls","description":"## Problem\nThe fetchJoplinFoldersAPI function in background.js (line 501) constructs URLs via string concatenation without URL encoding or token format validation.\n\n## Evidence\nbackground.js:501:\nconst apiUrl = \"${JOPLIN_API_BASE_URL}${JOPLIN_API_FOLDERS_ENDPOINT}?token=${joplinToken}\";\n\n## Impact\n- Malformed tokens could break URL parsing\n- Special characters in token not encoded\n- No validation that token matches expected format\n\n## Fix Required\n1. Validate token format with regex (alphanumeric, 10-100 chars)\n2. Use URL API for safe construction:\n   const apiUrl = new URL(JOPLIN_API_FOLDERS_ENDPOINT, JOPLIN_API_BASE_URL);\n   apiUrl.searchParams.append('token', joplinToken);\n3. Apply same pattern to createJoplinNoteAPI","status":"open","priority":2,"issue_type":"bug","owner":"bogorad@gmail","created_at":"2026-01-31T15:14:39.296906593+01:00","created_by":"Eugene Bogorad","updated_at":"2026-01-31T15:14:39.296906593+01:00"}
